<!DOCTYPE html>
<html>
<head>
    <title>Chat with LLM</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
</head> 
    
<body>
<div id="chat-container">
    <input type="text" id="gcs-path-input" placeholder="Enter Google Cloud Storage path..."> <button id="set-gcs-path">Set Path</button><br><br>
    <div id="chat-history"></div>
    <input type="text" id="user-input" placeholder="Type your message...">
    <button id="send-button">Send</button>
</div>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
       const chatHistory = document.getElementById('chat-history');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const gcsPathInput = document.getElementById('gcs-path-input');
    const setGcsPathButton = document.getElementById('set-gcs-path');

    let chatHistoryArray = [];
    let gcsPath = ''; // Store the GCS path

    setGcsPathButton.addEventListener('click', () => {
        gcsPath = gcsPathInput.value;
        console.log("GCS Path set to:", gcsPath); // Log the path for now  You'll use this in your /discuss route
        // Optionally, provide feedback to the user, e.g., alert("GCS path set!");
    });


    sendButton.addEventListener('click', () => {
        const userMessage = userInput.value;
        appendMessage('user', userMessage);


        axios.post('/discuss', {
            prompt: userMessage,
            history: chatHistoryArray,
            path: gcsPath // Send the GCS path to the backend
        })
        .then(response => {
            const botMessage = response.data.message;
            chatHistoryArray = response.data.history;
            appendMessage('bot', botMessage);

        })
        .catch(error => {
            console.error('Error:', error);
            appendMessage('bot', 'An error occurred. Please try again later.');
        });
        userInput.value = '';
    });


    function appendMessage(sender, message) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', `${sender}-message`);

        if (typeof message === 'object' && message !== null) {
            const formattedContent = marked.parse(message.content); // Use marked.js to parse markdown
            messageDiv.innerHTML = `${message.role}: ${formattedContent}`; // Set as innerHTML for rendered markdown

        } else {
            messageDiv.textContent = message; 
        }

        if (sender === 'user') {
        messageDiv.style.color = 'blue'; // Make user messages blue
    }

        chatHistory.appendChild(messageDiv);
        chatHistory.scrollTop = chatHistory.scrollHeight;
    }

</script>

</body>
</html>

